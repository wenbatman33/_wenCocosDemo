{"version":3,"sources":["file:///Users/batman_work/workspace3.0/applearning/_wenCocosDemo/assets/Scripts/test_1.ts"],"names":["_decorator","Component","input","Input","Vec3","UITransform","ccclass","property","main","touchOffset","isDragging","start","on","EventType","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","event","char","node","getChildByName","parentTransform","getComponent","uiPos","getUILocation","touchLocalPos","convertToNodeSpaceAR","x","y","charPos","getPosition","subtract","newPos","add","setPosition","update","deltaTime"],"mappings":";;;;;;;;;;AACEA,MAAAA,U,OAAAA,U;AACAC,MAAAA,S,OAAAA,S;AACAC,MAAAA,K,OAAAA,K;AACAC,MAAAA,K,OAAAA,K;AAGAC,MAAAA,I,OAAAA,I;AACAC,MAAAA,W,OAAAA,W;;;;;;;;;OAEI;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBP,U;;sBAGjBQ,I,WADZF,OAAO,CAAC,MAAD,C,gBAAR,MACaE,IADb,SAC0BP,SAD1B,CACoC;AAAA;AAAA;AAClC;AADkC,eAE1BQ,WAF0B,GAEN,IAAIL,IAAJ,EAFM;AAGlC;AAHkC,eAI1BM,UAJ0B,GAIJ,KAJI;AAAA;;AAMlCC,QAAAA,KAAK,GAAG;AACNT,UAAAA,KAAK,CAACU,EAAN,CAAST,KAAK,CAACU,SAAN,CAAgBC,WAAzB,EAAsC,KAAKC,YAA3C,EAAyD,IAAzD;AACAb,UAAAA,KAAK,CAACU,EAAN,CAAST,KAAK,CAACU,SAAN,CAAgBG,UAAzB,EAAqC,KAAKC,WAA1C,EAAuD,IAAvD;AACAf,UAAAA,KAAK,CAACU,EAAN,CAAST,KAAK,CAACU,SAAN,CAAgBK,SAAzB,EAAoC,KAAKC,UAAzC,EAAqD,IAArD;AACD;;AAEDJ,QAAAA,YAAY,CAACK,KAAD,EAAoB;AAC9B,gBAAMC,IAAI,GAAG,KAAKC,IAAL,CAAUC,cAAV,CAAyB,MAAzB,CAAb;AACA,cAAI,CAACF,IAAL,EAAW;AAEX,gBAAMG,eAAe,GAAG,KAAKF,IAAL,CAAUG,YAAV,CAAuBpB,WAAvB,CAAxB;AACA,cAAI,CAACmB,eAAL,EAAsB,OALQ,CAO9B;;AACA,gBAAME,KAAK,GAAGN,KAAK,CAACO,aAAN,EAAd;AACA,gBAAMC,aAAa,GAAGJ,eAAe,CAACK,oBAAhB,CACpB,IAAIzB,IAAJ,CAASsB,KAAK,CAACI,CAAf,EAAkBJ,KAAK,CAACK,CAAxB,EAA2B,CAA3B,CADoB,CAAtB,CAT8B,CAa9B;;AACA,gBAAMC,OAAO,GAAGX,IAAI,CAACY,WAAL,EAAhB,CAd8B,CAgB9B;;AACA7B,UAAAA,IAAI,CAAC8B,QAAL,CAAc,KAAKzB,WAAnB,EAAgCuB,OAAhC,EAAyCJ,aAAzC;AAEA,eAAKlB,UAAL,GAAkB,IAAlB;AACD;;AAEDO,QAAAA,WAAW,CAACG,KAAD,EAAoB;AAC7B,cAAI,CAAC,KAAKV,UAAV,EAAsB;AAEtB,gBAAMW,IAAI,GAAG,KAAKC,IAAL,CAAUC,cAAV,CAAyB,MAAzB,CAAb;AACA,cAAI,CAACF,IAAL,EAAW;AAEX,gBAAMG,eAAe,GAAG,KAAKF,IAAL,CAAUG,YAAV,CAAuBpB,WAAvB,CAAxB;AACA,cAAI,CAACmB,eAAL,EAAsB,OAPO,CAS7B;;AACA,gBAAME,KAAK,GAAGN,KAAK,CAACO,aAAN,EAAd;AACA,gBAAMC,aAAa,GAAGJ,eAAe,CAACK,oBAAhB,CACpB,IAAIzB,IAAJ,CAASsB,KAAK,CAACI,CAAf,EAAkBJ,KAAK,CAACK,CAAxB,EAA2B,CAA3B,CADoB,CAAtB,CAX6B,CAe7B;;AACA,gBAAMI,MAAM,GAAG,IAAI/B,IAAJ,EAAf;AACAA,UAAAA,IAAI,CAACgC,GAAL,CAASD,MAAT,EAAiBP,aAAjB,EAAgC,KAAKnB,WAArC;AACAY,UAAAA,IAAI,CAACgB,WAAL,CAAiBF,MAAjB;AACD;;AAEDhB,QAAAA,UAAU,CAACC,KAAD,EAAoB;AAC5B,eAAKV,UAAL,GAAkB,KAAlB;AACD;;AAED4B,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAAE;;AA3DM,O","sourcesContent":["import {\n  _decorator,\n  Component,\n  input,\n  Input,\n  Node,\n  EventTouch,\n  Vec3,\n  UITransform,\n} from \"cc\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"main\")\nexport class main extends Component {\n  // 記錄手指與物件的偏移量\n  private touchOffset: Vec3 = new Vec3();\n  // 是否正在拖曳\n  private isDragging: boolean = false;\n\n  start() {\n    input.on(Input.EventType.TOUCH_START, this.onTouchStart, this);\n    input.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\n    input.on(Input.EventType.TOUCH_END, this.onTouchEnd, this);\n  }\n\n  onTouchStart(event: EventTouch) {\n    const char = this.node.getChildByName(\"char\");\n    if (!char) return;\n\n    const parentTransform = this.node.getComponent(UITransform);\n    if (!parentTransform) return;\n\n    // 取得觸摸位置的本地座標\n    const uiPos = event.getUILocation();\n    const touchLocalPos = parentTransform.convertToNodeSpaceAR(\n      new Vec3(uiPos.x, uiPos.y, 0)\n    );\n\n    // 取得物件目前的位置\n    const charPos = char.getPosition();\n\n    // 計算偏移量：物件位置 - 觸摸位置\n    Vec3.subtract(this.touchOffset, charPos, touchLocalPos);\n\n    this.isDragging = true;\n  }\n\n  onTouchMove(event: EventTouch) {\n    if (!this.isDragging) return;\n\n    const char = this.node.getChildByName(\"char\");\n    if (!char) return;\n\n    const parentTransform = this.node.getComponent(UITransform);\n    if (!parentTransform) return;\n\n    // 取得觸摸位置的本地座標\n    const uiPos = event.getUILocation();\n    const touchLocalPos = parentTransform.convertToNodeSpaceAR(\n      new Vec3(uiPos.x, uiPos.y, 0)\n    );\n\n    // 套用偏移量：新位置 = 觸摸位置 + 偏移量\n    const newPos = new Vec3();\n    Vec3.add(newPos, touchLocalPos, this.touchOffset);\n    char.setPosition(newPos);\n  }\n\n  onTouchEnd(event: EventTouch) {\n    this.isDragging = false;\n  }\n\n  update(deltaTime: number) {}\n}\n"]}